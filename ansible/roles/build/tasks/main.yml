- name: add line to bashrc
  lineinfile: dest={{ ansible_env.HOME }}/.bashrc line="source /opt/ros/humble/setup.bash"

- name: Creates build directory
  file:
    path: ../Sophus_build
    state: directory

- name: build Sophus
  become: yes
  shell: |
    cd ../Sophus_build
    cmake ../Sophus
    make install

- name: set environment for ROS 2
  shell: source /opt/ros/humble/setup.bash
  args:
    executable: /bin/bash

- name: rosdep init
  become: yes
  shell: rosdep init
  ignore_errors: yes

- name: rosdep update
  become: yes
  shell: rosdep update

- name: rosdep install
  become: yes
  shell: rosdep install -y -r -q --from-paths ../sirius_ws/src --ignore-src --rosdistro humble -y

- name: uninstall sophus
  become: yes
  shell: apt -y purge ros-humble-sophus

- name: colcon build
  shell: |
    cd ../sirius_ws 
    source /opt/ros/humble/setup.bash && colcon build --symlink-install
  args:
    executable: /bin/bash

- name: set udev-rules for kobuki
  become: yes
  shell: |
    cp ../sirius_ws/src/kobuki_ftdi/60-kobuki.rules /etc/udev/rules.d
    service udev reload
    service udev restart
  args:
    executable: /bin/bash
